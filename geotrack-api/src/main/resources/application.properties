# =============================================================================
# GeoTrack API Service Configuration
# =============================================================================

# Application
quarkus.application.name=geotrack-api
quarkus.http.port=8080

# =============================================================================
# Database — PostgreSQL + PostGIS
# Quarkus Dev Services auto-starts a PostGIS container in dev/test mode.
# No Docker Compose needed for development!
# =============================================================================
quarkus.datasource.db-kind=postgresql
quarkus.datasource.devservices.image-name=postgis/postgis:16-3.4
quarkus.datasource.devservices.port=5432

# Explicit connection for docker-compose (overrides Dev Services when set)
%dev.quarkus.datasource.devservices.enabled=false
%dev.quarkus.datasource.jdbc.url=jdbc:postgresql://localhost:5432/geotrack
%dev.quarkus.datasource.username=geotrack
%dev.quarkus.datasource.password=geotrack
%dev.quarkus.kafka.devservices.enabled=false
%dev.quarkus.redis.devservices.enabled=false

# Hibernate ORM
quarkus.hibernate-orm.database.generation=none
quarkus.hibernate-orm.log.sql=true
# Hibernate 6.6+ auto-detects PostGIS dialect; explicit not needed
# quarkus.hibernate-orm.dialect=org.hibernate.spatial.dialect.postgis.PostgisPG10Dialect

# Flyway database migrations
quarkus.flyway.migrate-at-start=true
quarkus.flyway.locations=classpath:db/migration

# =============================================================================
# Kafka — Event streaming
# Dev Services auto-starts Redpanda (Kafka-compatible) in dev/test mode.
# =============================================================================
kafka.bootstrap.servers=${KAFKA_BOOTSTRAP:localhost:9092}

mp.messaging.outgoing.position-events.connector=smallrye-kafka
mp.messaging.outgoing.position-events.topic=position.raw
mp.messaging.outgoing.position-events.value.serializer=org.apache.kafka.common.serialization.StringSerializer

# Incoming: processed positions (for WebSocket bridge)
mp.messaging.incoming.ws-positions.connector=smallrye-kafka
mp.messaging.incoming.ws-positions.topic=position.processed
mp.messaging.incoming.ws-positions.group.id=ws-bridge-group
mp.messaging.incoming.ws-positions.value.deserializer=org.apache.kafka.common.serialization.StringDeserializer

# Incoming: geofence alerts (for WebSocket bridge)
mp.messaging.incoming.ws-alerts.connector=smallrye-kafka
mp.messaging.incoming.ws-alerts.topic=alert.geofence
mp.messaging.incoming.ws-alerts.group.id=ws-bridge-group
mp.messaging.incoming.ws-alerts.value.deserializer=org.apache.kafka.common.serialization.StringDeserializer

# =============================================================================
# Redis — Caching
# Dev Services auto-starts Redis in dev/test mode.
# =============================================================================
quarkus.redis.devservices.enabled=true

# =============================================================================
# Health & Metrics
# =============================================================================
quarkus.smallrye-health.root-path=/q/health
quarkus.micrometer.export.prometheus.path=/q/metrics

# =============================================================================
# OpenAPI / Swagger UI
# =============================================================================
quarkus.smallrye-openapi.info-title=GeoTrack API
quarkus.smallrye-openapi.info-version=1.0.0
quarkus.smallrye-openapi.info-description=Real-Time Geospatial Asset Tracking Platform
quarkus.swagger-ui.always-include=true

# =============================================================================
# CORS (for Angular frontend)
# =============================================================================
quarkus.http.cors=true
quarkus.http.cors.origins=http://localhost:4200,http://localhost:30000,http://localhost:8888
quarkus.http.cors.methods=GET,POST,PUT,DELETE,OPTIONS
quarkus.http.cors.headers=Content-Type,Authorization

# =============================================================================
# Logging
# =============================================================================
quarkus.log.console.format=%d{yyyy-MM-dd HH:mm:ss} %-5p [%c{2.}] (%t) %s%e%n
quarkus.log.level=INFO
quarkus.log.category."com.geotrack".level=DEBUG


